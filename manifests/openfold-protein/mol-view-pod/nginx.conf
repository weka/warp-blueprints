server {
    listen       8080;
    server_name  _;

    # Serve static app
    root   /usr/share/nginx/html;
    index  index.html;

    # Basic security/headers
    add_header X-Content-Type-Options nosniff;
    add_header X-Frame-Options SAMEORIGIN;

    # Back-compat: still serve a single default file at /structure.pdb
    location = /structure.pdb {
        alias /data/structure.pdb;
        add_header Access-Control-Allow-Origin *;
        add_header Cache-Control "no-store";
        types { }
        default_type chemical/x-pdb;
    }

    # NEW: Expose the entire mounted directory under /files/
    # This allows the viewer to request any file from the PVC mounted at /data
    location /files/ {
        alias /data/;
        add_header Access-Control-Allow-Origin *;
        add_header Cache-Control "no-store";
        # Basic type mapping for common structure formats
        types {
            chemical/x-pdb   pdb ent;
            chemical/x-mmcif cif mmcif;
            application/octet-stream bcif gz;
        }
        default_type application/octet-stream;
        autoindex on;
    }

    # App routes
    location / {
        try_files $uri $uri/ /index.html;
    }

    # Health check
    location = /healthz {
        return 200 'ok';
        add_header Content-Type text/plain;
    }
}
